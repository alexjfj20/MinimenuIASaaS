 FASE 3 â€” Sistema de Planes BASE (sin automatizaciÃ³n)
**************************************************************

Perfecto ğŸ‘Œ â€” vamos paso a paso como debe ser para no romper tu SaaS.

AquÃ­ tienes el **PROMPT listo para copiar y pegar** para que tu IA implemente Ãºnicamente la:

ğŸ‘‰ **FASE 3 â€” Sistema de Planes BASE (sin automatizaciÃ³n)**

Esto solo crea la estructura de planes y asignaciÃ³n a negocios, sin tocar mÃ³dulos ni integraciones.

---

comienza aqui el prompt:



ActÃºa como un **Arquitecto SaaS Senior + Full-Stack Developer experto en Next.js, Supabase/Firebase y sistemas multi-tenant**.

Necesito que implementes en mi aplicaciÃ³n SaaS existente la **FASE 3 â€” Sistema de Planes Base**, sin automatizaciones, sin romper funcionalidades actuales y manteniendo compatibilidad con todo el sistema.

---

# ğŸ¯ Objetivo

Implementar Ãºnicamente la base estructural de planes para que:

1. Pueda crear planes desde el panel Super Admin.
2. Pueda asignar un plan a un negocio.
3. Pueda visualizar el plan actual del negocio.
4. No se active nada automÃ¡tico aÃºn.
5. No se modifiquen mÃ³dulos, integraciones ni servicios existentes.

---

# âš ï¸ Restricciones crÃ­ticas

* No eliminar tablas actuales.
* No modificar lÃ³gica de permisos.
* No automatizar activaciones.
* No tocar negocio_modulos, negocio_integraciones ni negocio_servicios.
* Solo crear estructura de planes y su asignaciÃ³n.

---

# ğŸ—„ï¸ Base de datos a implementar

## 1ï¸âƒ£ Tabla: planes

Crear tabla:

* id (PK)
* nombre (string)
* descripcion (text)
* precio (decimal)
* tipo (enum: mensual | anual | Ãºnico)
* estado (activo | inactivo)
* created_at (timestamp)
* updated_at (timestamp)

Agregar Ã­ndices por:

* estado
* tipo

---

## 2ï¸âƒ£ Tabla: negocio_planes

RelaciÃ³n entre negocio y plan.

Campos:

* id (PK)
* negocio_id (FK â†’ negocios.id)
* plan_id (FK â†’ planes.id)
* fecha_inicio (date)
* fecha_fin (date nullable)
* estado (activo | vencido | cancelado)
* created_at
* updated_at

Reglas:

* Un negocio solo puede tener 1 plan activo.
* Permitir historial de planes anteriores.

---

# âš™ï¸ Backend / lÃ³gica requerida

Implementar servicios para:

---

## Crear plan

Endpoint / servicio:

```
POST /planes
```

Debe permitir:

* nombre
* descripcion
* precio
* tipo
* estado

Validar:

* Nombre Ãºnico
* Precio â‰¥ 0

---

## Listar planes

```
GET /planes
```

Mostrar:

* Cantidad de negocios por plan
* Estado
* Precio

---

## Asignar plan a negocio

Endpoint:

```
POST /negocios/{id}/asignar-plan
```

LÃ³gica:

1. Verificar que el negocio exista.
2. Verificar que el plan exista.
3. Desactivar plan activo anterior.
4. Insertar nuevo en negocio_planes.
5. Marcar estado = activo.

âš ï¸ No activar mÃ³dulos ni integraciones.

---

## Obtener plan actual de negocio

```
GET /negocios/{id}/plan
```

Debe devolver:

* Nombre plan
* Precio
* Tipo
* Fecha inicio
* Estado

---

# ğŸ–¥ï¸ Cambios UI requeridos

## 1ï¸âƒ£ SecciÃ³n nueva: Planes

En Super Admin sidebar:

```
Planes
```

Vista debe permitir:

* Crear plan
* Editar plan
* Activar / desactivar
* Ver negocios suscritos

---

## 2ï¸âƒ£ En gestiÃ³n de negocio

Ruta:

```
Negocios â†’ Gestionar â†’ [Negocio]
```

Agregar bloque:

```
Plan actual: PRO
Precio: $49
Tipo: Mensual
Fecha inicio: 01/02/2026

[ Cambiar plan ]
```

Selector dropdown con planes activos.

---

# ğŸ§ª Casos de prueba obligatorios

1. Crear plan bÃ¡sico.
2. Crear plan premium.
3. Asignar plan a negocio sin plan.
4. Cambiar plan activo.
5. Historial de planes correcto.
6. Negocio sin plan asignado.
7. Plan inactivo no seleccionable.

---

# ğŸ›¡ï¸ Seguridad y estabilidad

Implementar:

* Transacciones al cambiar plan.
* ValidaciÃ³n FK.
* Soft delete opcional.
* Logs de asignaciÃ³n.
* Manejo de errores.

---

# ğŸ“¦ Entregables esperados

1. MigraciÃ³n SQL tablas planes y negocio_planes.
2. Modelos / Schemas.
3. Endpoints CRUD planes.
4. Endpoint asignar plan.
5. UI gestiÃ³n planes.
6. UI asignaciÃ³n en negocio.
7. Historial de planes.
8. DocumentaciÃ³n tÃ©cnica.

---

# ğŸš€ Mejores prÃ¡cticas

* Multi-tenant safe.
* No hardcodear planes.
* Preparado para futura automatizaciÃ³n.
* CÃ³digo desacoplado de mÃ³dulos.
* Ãndices en FK.

---

Implementa Ãºnicamente la FASE 3 (Planes Base), dejando preparada la estructura para fases futuras sin automatizar activaciones ni modificar permisos actuales.





---

## âœ… QuÃ© lograrÃ¡ este prompt

Cuando tu IA lo implemente tendrÃ¡s:

* Sistema de planes creado
* Plan asignable a negocios
* Historial de planes
* UI de gestiÃ³n
* Base lista para automatizaciÃ³n

Pero aÃºn:

âŒ No activarÃ¡ mÃ³dulos
âŒ No activarÃ¡ integraciones
âŒ No activarÃ¡ servicios

(eso es Fase 5).

---




Cuando termines esta fase, el siguiente prompt que sigue es:

ğŸ‘‰ **â€œLigar Plan â†’ MÃ³dulos / Integraciones / Servicios (sin automatizar aÃºn)â€**

AsÃ­ avanzas seguro sin romper nada.

Cuando lo tengas listo dime:
**â€œSiguiente fase promptâ€** ğŸš€
